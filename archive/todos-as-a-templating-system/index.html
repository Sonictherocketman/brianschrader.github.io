<!DOCTYPE html>
<html>
<head>
  <title>TODOs as a Templating System - BiteofanApple</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" type="text/css" href="/bin/css/stylesheet.css?v=1.1">
  <link rel="stylesheet" type="text/css" href="/bin/css/mobile.css">
  <link rel="webmention" href="https://pine.blog/api/webmention/r/f4ecb3b3-6edc-4baa-9553-4f678c3e4b96" />
  <link rel="icon" type="image/png" href="//www.gravatar.com/avatar/11b074a636e00292c98e3e60f7e16595?size=30">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="TODOs as a Templating System" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://brianschrader.com/archive/todos-as-a-templating-system/" />
  <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/>
  <link rel="alternate" type="application/json" title="JSON Feed" href="/feed.json"/>
</head>
<body>
<div id="content">
  <div class="nav-container">
    <nav class="nav">
      <div class="nav-item nav-brand">
        <a href="/" class="site-title">
          BiteofanApple
        </a>
        <span
          class="author-tag hide-on-mobile"
        >
          by <a href="/about/">Brian Schrader</a>
        </span>
      </div>
      <div class="nav-item"><a href="/archive/">Archive</a></div>
      <div class="nav-item"><a href="/about/">About</a></div>
      <div class="nav-item"><a href="https://skyrocket.software">Apps</a></div>
      <div class="nav-item"><a href="https://pine.blog/u/sonicrocketman">Microblog</a></div>
    </nav>
  </div>
  <div class="bars">
      <div class="main-bar">
        <article class="h-entry">
          <a href="/" class="u-author"></a>
          <div class="post">
          <div class="article-title">
            <h1 class="p-name"><a href="/archive/todos-as-a-templating-system/">TODOs as a Templating System</a></h1>
            <small style="font-style:italic;">
              <time class="dt-published" datetime="2017-07-31T15:24:00-08:00">
                Posted on Mon, 31 Jul 2017 at 03:24 PM
              </time>
            </small>
          </div>
          <div class="article-content e-content">
            <p>When I sit down to start a new feature or project the blank page or empty function can be extremely intimidating; a void of infinite complexity. I'm sure lots of developers do this, and maybe most don't realize it, but I've found that <code>TODO</code> comments are super useful in helping to abstract away nitpicky details and focus on the overall purpose of the code as I'm writing it. Let's say that we want to validate some parameters from an HTTP request and kick off a background task to send an email to a list of requested users. First off, we need to handle the request and kick off the task, but there's a bunch of validation and database queries we need to make before we can do that, and we haven't even written the task function yet, that's where <code>TODOs</code> come in.</p>
<pre><code>class MassEmailView(APIView)
    # TODO: check if user has permission to send mass mail
    def post(self, request):
        # TODO: Get users from the request
        users = []
        for user in users:
            # TODO: send the message
            pass
        return Response(None, status=200)
</code></pre>
<p>Right off the bat I know that I need to get a list of users and do something with each of them. In a lot of ways I'm basically writing pseudo-code and slowly filling in the blanks with real code. Next, let's say we write the background task.</p>
<pre><code># ---- tasks.py ----
@shared_task
def send_email(user, subject, message_text):
    email.send(user.email, subject, text=message_text)

# ---- views.py ----
class MassEmailView(APIView)
    # TODO: check if user has permission to mass send mail
    def post(self, request):
        # TODO: Get users, subject, and text from the request
        users = []
        subject = ''
        text = ''
        for user in users:
            tasks.send_email.delay(user, subject, text)
        return Response(None, status=200)
</code></pre>
<p>Slowly the code is coming together. I've written the background task and updated my view. The basic structure is there, but I haven't done the work of parsing the request or any error handling, so let's move on to that.</p>
<pre><code># ---- tasks.py ----
@shared_task
def send_email(user, subject, message_text):
    email.send(user.email, subject, text=message_text)

# ---- views.py ----
class MassEmailView(APIView)
    @authentication_classes((SessionAuthetication,))
    @permission_classes((IsAdmin,))
    def post(self, request):
        try:
            users = [
                User.objects.get(username=username)
                for username in request.POST['users'].split(',')
            ]
        except ObjectDoesNotExist:
            return Response(INVALID_USER_RESPONSE, status=400)

        subject = request.POST['message_text']
        text = request.POST['message_text']
        for user in users:
            tasks.send_email.delay(user, subject, text)
        return Response(None, status=200)
</code></pre>
<p>Now that we're done, it's clear that the <code>TODO</code> comments were hiding quite a bit of complexity, but the overall structure is the same. Just because our code is read by the computer from top to bottom doesn't mean we have to write it that way. Sometimes it helps to start with a rough outline of the whole picture, and slowly color it in bit by bit.</p>
<p><link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script></p>
          </div>
          <hr />
          <small>
            Filed under:
            <span class="tags article-content">
              <a href="/tags.html#tag-software development" title="software development" class="tag">software development</a>, <a href="/tags.html#tag-programming" title="programming" class="tag">programming</a>, <a href="/tags.html#tag-thought technology" title="thought technology" class="tag">thought technology</a>
            </span>
          </small>
        </div>
        </article>
      </div>
      <div class="side-bar">
        <div class="promotion">
          <div>
            <a href="https://goingindie.tech" title="Going Indie More Information">
              <img
                  class="promotion-cover"
                  src="/images/going-indie/cover-icon.jpg"
                  height="100px"
                  width="100px"
              />
            </a>
          </div>
          <div>
            Going Indie
            <small>
              <p>
                A complete guide to becoming an independent software developer
              </p>
              <a href="https://goingindie.tech" title="Going Indie Order Now">
              Order Now &#8594;
              </a>
            </small>
          </div>
        </div>
        <h4>Also Me</h4>
        <ul>
          <li><a href="http://pine.blog/u/sonicrocketman" title="Pine.blog" rel="nofollow me">
            Pine.blog
          </a></li>
          <li><a href="https://github.com/sonictherocketman/" title="GitHub" rel="nofollow me">
            GitHub
          </a></li>
          <li><a href="https://twitter.com/sonicrocketman" title="Twitter" rel="nofollow me">
            Twitter
          </a></li>
          <li><a href="//pinboard.in/u:sonicrocketman/public/" title="Pinboard" rel="nofollow me">
            Pinboard
          </a></li>
          <li><a href="http://photos.brianschrader.com" title="My Photoblog" rel="nofollow me">
            Photoblog
          </a></li>
          <li><a href="https://en.gravatar.com/sonicrocketman" title="Gravatar" rel="nofollow me">
            Gravatar
          </a></li>
          <li><a href="https://sonicrocketman.bandcamp.com" title="Bandcamp" rel="nofollow me">
            Bandcamp
          </a></li>
          <li><a href="https://www.goodreads.com/user/show/119559749-brian-schrader" title="Goodreads" rel="nofollow me">
            Goodreads
          </a></li>
        </ul>
        <h4>Projects</h4>
        <ul>
          <li><a href="http://democracyandprogress.com" title="Democracy and Progress">
            Democracy &amp; Progress
          </a></li>
          <li><a href="https://goingindie.tech" title="Going Indie">
            Going Indie
          </a></li>
          <li><a href="https://pine.blog" title="Pine.blog" rel="nofollow">
            Pine.blog
          </a></li>
          <li><a href="https://indiedevlife.fm" title="Indie Dev Life Podcast">
            Indie Dev Life Podcast
          </a></li>
          <li><a href="https://nine9s.cloud" title="Nine9s" rel="nofollow">
            Nine9s
          </a></li>
          <li><a href="https://d20.photos" title="d20.photos" rel="nofollow">
            d20.photos
          </a></li>
          <li><a href="https://adventurerscodex.com" title="Adventurer's Codex" rel="nofollow">
            Adventurer&apos;s Codex
          </a></li>
        </ul>
        <h4>Resources</h4>
        <ul>
          <li><a href="/archive/bookshelf" title="Book Recommendations">
            Book Recommendations
          </a></li>
          <li><a href="/archive/recipes/" title="Food and Drink Recipes">
            Food &amp; Drink Recipes
          </a></li>
          <li><a href="/tags.html" title="Posts by Tag">
            Tags
          </a></li>
        </ul>
        <h4>Other Writings</h4>
        <ul>
          <b>The Way Forward (Series)</b>
          <li>
            <ul>
              <li><a href="https://sduptownnews.com/guest-editorial-the-way-forward-conquering-the-pandemic/" title="Conquering the pandemic">
                Conquering the pandemic
              </a></li>
              <li><a href="https://sduptownnews.com/guest-editorial-the-way-forward-jobs-for-all/" title="Jobs for all">
                Jobs for all
              </a></li>
              <li><a href="https://sduptownnews.com/the-way-forward-democracy-is-the-answer/" title="Democracy is the answer">
                Democracy is the answer
              </a></li>
            </ul>
          </li>
        </ul>
        <ul>
          <b>Assorted Works</b>
          <li>
            <ul>
              <li><a href="https://sduptownnews.com/californians-deserve-better-data-protection/" title="Californians deserve better data protection">
                Californians deserve better data protection
              </a></li>
              <li><a href="https://sduptownnews.com/not-planning-on-voting-read-this/" title="Not planning on voting? Read this">
                Not planning on voting? Read this
              </a></li>
              <li><a href="https://sduptownnews.com/guest-editorial-rounding-the-corner/" title="Rounding the corner">
                Rounding the corner
              </a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div style="text-align:center;">
      <div class="article-content">
        <span style="font-size:small;">
          <a rel="alternate" href="/rss.xml">
            RSS
          </a>
      </div>
    </div>
  </div>
</div>
</body>
</html>
